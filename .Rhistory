add.params = list(color = "blue",
fill = "lightgray")
)+
stat_cor(method = "pearson", label.x = 3, label.y = 30)  # Add correlation coefficient
combined_data <- combined_data[combined_data$kraken2 > 0]
combined_data <- combined_data[combined_data$kraken2 > 0,]
ggscatter(combined_data, x = "kraken2", y = "CPM",
add = "reg.line",                                 # Add regression line
conf.int = TRUE,                                  # Add confidence interval
add.params = list(color = "blue",
fill = "lightgray")
)+
stat_cor(method = "pearson", label.x = 3, label.y = 30)  # Add correlation coefficient
all_alignments <- log2(all_alignments)
all_alignments <- cbind(DSMH4,DSMH5,DSMH6,DSMH7,SMH4,SMH5,SMH6,SMH7)
all_alignments <- log2(all_alignments)
all_alignments <- all_alignments %>% rownames_to_column(var="Species")
all_alignments_melt <- reshape2::melt(all_alignments, .id_vars = "Species")
species_level <- read.csv("./Varroa 2/species_level.csv", header = T, encoding = "UTF-8")
colnames(species_level) <- samples
species_level <- log2(species_level)
species_level$Species <- species
species_level_melt <- species_level %>% reshape2::melt(., .id_vars="Species")
combined_data <- merge(all_alignments_melt,species_level_melt, by=c("Species","variable"))
colnames(combined_data) <- c("Species","Method","CPM","kraken2")
combined_data <- combined_data[combined_data$kraken2 > 0,]
ggscatter(combined_data, x = "kraken2", y = "CPM",
add = "reg.line",                                 # Add regression line
conf.int = TRUE,                                  # Add confidence interval
add.params = list(color = "blue",
fill = "lightgray")
)+
stat_cor(method = "pearson", label.x = 3, label.y = 30)  # Add correlation coefficient
species_level <- read.csv("./Varroa 2/genus_level.csv", header = T, encoding = "UTF-8")
colnames(species_level) <- samples
species_level <- log2(species_level)
species_level$Species <- species
species_level_melt <- species_level %>% reshape2::melt(., .id_vars="Species")
combined_data <- merge(all_alignments_melt,species_level_melt, by=c("Species","variable"))
colnames(combined_data) <- c("Species","Method","CPM","kraken2")
combined_data <- combined_data[combined_data$kraken2 > 0,]
ggscatter(combined_data, x = "kraken2", y = "CPM",
add = "reg.line",                                 # Add regression line
conf.int = TRUE,                                  # Add confidence interval
add.params = list(color = "blue",
fill = "lightgray")
)+ stat_cor(method = "pearson", label.x = 3, label.y = 30)  # Add correlation coefficient
colnames(combined_data) <- c("Species","Method","CPM","DESeq2")
combined_data <- combined_data[combined_data$kraken2 > 0,]
ggscatter(combined_data, x = "kraken2", y = "CPM",
add = "reg.line",                                 # Add regression line
conf.int = TRUE,                                  # Add confidence interval
add.params = list(color = "blue",
fill = "lightgray")
)+ stat_cor(method = "pearson", label.x = 3, label.y = 30)  # Add correlation coefficient
ggscatter(combined_data, x = "DESeq2", y = "CPM",
add = "reg.line",                                 # Add regression line
conf.int = TRUE,                                  # Add confidence interval
add.params = list(color = "blue",
fill = "lightgray")
)+ stat_cor(method = "pearson", label.x = 3, label.y = 30)  # Add correlation coefficient
combined_data <- combined_data[combined_data$DESeq2 > 0,]
combined_data <- merge(all_alignments_melt,species_level_melt, by=c("Species","variable"))
colnames(combined_data) <- c("Species","Method","CPM","DESeq2")
combined_data <- combined_data[combined_data$DESeq2 > 0,]
ggscatter(combined_data, x = "DESeq2", y = "CPM",
add = "reg.line",                                 # Add regression line
conf.int = TRUE,                                  # Add confidence interval
add.params = list(color = "blue",
fill = "lightgray")
)+ stat_cor(method = "pearson", label.x = 3, label.y = 30)  # Add correlation coefficient
ggscatter(combined_data, x = "DESeq2", y = "CPM",
add = "reg.line",                                 # Add regression line
conf.int = TRUE,                                  # Add confidence interval
add.params = list(color = "blue",
fill = "lightgray")
)+ stat_cor(method = "pearson", label.x = 3, label.y = 30) + ggtitle("Using kraken2 Genus level")  # Add correlation coefficient
species_level <- read.csv("./Varroa 2/species_level.csv", header = T, encoding = "UTF-8")
colnames(species_level) <- samples
species_level <- log2(species_level)
species_level$Species <- species
species_level_melt <- species_level %>% reshape2::melt(., .id_vars="Species")
combined_data <- merge(all_alignments_melt,species_level_melt, by=c("Species","variable"))
colnames(combined_data) <- c("Species","Method","CPM","DESeq2")
combined_data <- combined_data[combined_data$DESeq2 > 0,]
ggscatter(combined_data, x = "DESeq2", y = "CPM",
add = "reg.line",                                 # Add regression line
conf.int = TRUE,                                  # Add confidence interval
add.params = list(color = "blue",
fill = "lightgray")
)+ stat_cor(method = "pearson", label.x = 3, label.y = 30) + ggtitle("Using kraken2 Species level")  # Add correlation coefficient
View(all_alignments)
colnames(combined_data) <- c("Species","Sample","CPM","DESeq2")
combined_data$Method <- rep(c("DirectSM","SM"), 5)
combined_data$Method <- rep(c("DirectSM","SM"), 24)
combined_data$Method <- rep(c("DirectSM","DirectSM","DirectSM","DirectSM","SM","SM","SM","SM"), 6)
ggscatter(combined_data, x = "DESeq2", y = "CPM",
add = "reg.line",                                 # Add regression line
conf.int = TRUE,                                  # Add confidence interval
add.params = list(color = "blue",
fill = "lightgray")
)+ stat_cor(method = "pearson", label.x = 3, label.y = 30) + ggtitle("Using kraken2 Species level") + ylim(0,20)  # Add correlation coefficient
ggscatter(combined_data, x = "DESeq2", y = "CPM",
add = "reg.line",                                 # Add regression line
conf.int = TRUE,                                  # Add confidence interval
add.params = list(color = "blue",
fill = "lightgray")
)+ stat_cor(method = "pearson", label.x = 3, label.y = 30) + ggtitle("Using kraken2 Species level") + ylim(0,15)  # Add correlation coefficient
combined_data <- combined_data[combined_data$DESeq2 > 0,]
ggscatter(combined_data, x = "DESeq2", y = "CPM",
add = "reg.line",                                 # Add regression line
conf.int = TRUE,                                  # Add confidence interval
add.params = list(color = "blue",
fill = "lightgray")
)+ stat_cor(method = "pearson", label.x = 3, label.y = 30) + ggtitle("Using kraken2 Species level") + ylim(0,15)  # Add correlation coefficient
ggscatter(combined_data, x = "DESeq2", y = "CPM",
add = "reg.line",                                 # Add regression line
conf.int = TRUE,                                  # Add confidence interval
add.params = list(color = "blue",
fill = "lightgray")
)+ stat_cor(method = "pearson", label.x = 3, label.y = 30) + ggtitle("Using kraken2 Species level")
ggscatter(combined_data, x = "DESeq2", y = "CPM", palette = "jco", add = "reg.line") +
scale_color_viridis(discrete=TRUE) +
theme_classic() +
facet_wrap(~ Species,scales = "free") +
theme(plot.title = element_text(size=14),
axis.text=element_text(size=12,colour = "black"),
axis.title=element_text(size=12),
legend.title = element_blank(),
legend.text = element_text(size = 12))+
ggtitle("Metagenomic correlation with Natural Varroa fall" ) +
ylab("Varroa count/day (log)") +
xlab("Normalised reads count (log)") +
stat_cor(aes(color = Monitoring))
ggscatter(combined_data, x = "DESeq2", y = "CPM", palette = "jco", add = "reg.line") +
theme_classic() +
facet_wrap(~ Species,scales = "free") +
theme(plot.title = element_text(size=14),
axis.text=element_text(size=12,colour = "black"),
axis.title=element_text(size=12),
legend.title = element_blank(),
legend.text = element_text(size = 12))+
ggtitle("Metagenomic correlation with Natural Varroa fall" ) +
ylab("Varroa count/day (log)") +
xlab("Normalised reads count (log)") +
stat_cor(aes(color = Monitoring))
ggscatter(combined_data, x = "DESeq2", y = "CPM",
add = "reg.line",                                 # Add regression line
conf.int = TRUE,                                  # Add confidence interval
add.params = list(color = "blue",
fill = "lightgray")
)+ stat_cor(method = "pearson", label.x = 3, label.y = 15) + ggtitle("Using kraken2 Species level")   # Add correlation coefficient
ggscatter(combined_data, x = "DESeq2", y = "CPM", palette = "jco", add = "reg.line") +
theme_classic() +
facet_wrap(~ Species,scales = "free") +
theme(plot.title = element_text(size=14),
axis.text=element_text(size=12,colour = "black"),
axis.title=element_text(size=12),
legend.title = element_blank(),
legend.text = element_text(size = 12))+
ggtitle("Metagenomic correlation with Natural Varroa fall" ) +
ylab("Varroa count/day (log)") +
xlab("Normalised reads count (log)") +
stat_cor()
ggscatter(combined_data, x = "DESeq2", y = "CPM", palette = "jco", add = "reg.line", shape = "Sample") +
theme_classic() +
facet_wrap(~ Species,scales = "free") +
theme(plot.title = element_text(size=14),
axis.text=element_text(size=12,colour = "black"),
axis.title=element_text(size=12),
legend.title = element_blank(),
legend.text = element_text(size = 12))+
ggtitle("Metagenomic correlation with Natural Varroa fall" ) +
ylab("Varroa count/day (log)") +
xlab("Normalised reads count (log)") +
stat_cor()
smh4 <- import_and_count_bam("./varroabam/smh4.bam")
dsmh4 <- import_and_count_bam("./varroabam/dsmh4.bam")
smh5 <- import_and_count_bam("./varroabam/smh5.bam")
dsmh5 <- import_and_count_bam("./varroabam/dsmh5.bam")
smh6 <- import_and_count_bam("./varroabam/smh6.bam")
dsmh6 <- import_and_count_bam("./varroabam/dsmh6.bam")
smh7 <- import_and_count_bam("./varroabam/smh7.bam")
dsmh7 <- import_and_count_bam("./varroabam/dsmh7.bam")
smh4
smh4_cpm <- (smh4/4058520) * 1000000
log2(smh4_cpm)
ggscatter(combined_data, x = "DESeq2", y = "CPM", palette = "jco", add = "reg.line", shape = "Sample") +
theme_classic() +
facet_wrap(~ Method,scales = "free") +
theme(plot.title = element_text(size=14),
axis.text=element_text(size=12,colour = "black"),
axis.title=element_text(size=12),
legend.title = element_blank(),
legend.text = element_text(size = 12))+
ggtitle("Metagenomic correlation with Natural Varroa fall" ) +
ylab("Varroa count/day (log)") +
xlab("Normalised reads count (log)") +
stat_cor()
ggscatter(combined_data, x = "DESeq2", y = "CPM", palette = "jco", add = "reg.line", shape = "Species") +
theme_classic() +
facet_wrap(~ Method,scales = "free") +
theme(plot.title = element_text(size=14),
axis.text=element_text(size=12,colour = "black"),
axis.title=element_text(size=12),
legend.title = element_blank(),
legend.text = element_text(size = 12))+
ggtitle("Metagenomic correlation with Natural Varroa fall" ) +
ylab("Varroa count/day (log)") +
xlab("Normalised reads count (log)") +
stat_cor()
ggscatter(combined_data, x = "DESeq2", y = "CPM", palette = "jco", add = "reg.line", shape = "Sample") +
theme_classic() +
facet_wrap(~ Species,scales = "free") +
theme(plot.title = element_text(size=14),
axis.text=element_text(size=12,colour = "black"),
axis.title=element_text(size=12),
legend.title = element_blank(),
legend.text = element_text(size = 12))+
ggtitle("Metagenomic correlation with Natural Varroa fall" ) +
ylab("Varroa count/day (log)") +
xlab("Normalised reads count (log)") +
stat_cor()
ggscatter(combined_data, x = "DESeq2", y = "CPM", palette = "jco", add = "reg.line", shape = "Sample") +
theme_classic() +
facet_grid(. ~ Species + Method,scales = "free") +
theme(plot.title = element_text(size=14),
axis.text=element_text(size=12,colour = "black"),
axis.title=element_text(size=12),
legend.title = element_blank(),
legend.text = element_text(size = 12))+
ggtitle("Metagenomic correlation with Natural Varroa fall" ) +
ylab("Varroa count/day (log)") +
xlab("Normalised reads count (log)") +
stat_cor()
all_alignments <- cbind(DSMH4,DSMH5,DSMH6,DSMH7,SMH4,SMH5,SMH6,SMH7)
all_alignments <- all_alignments %>% rownames_to_column(var="Species")
View(all_alignments)
full_import <- function(x, sample_name,f) {
y <- list.files(paste0("./varroa 2/wgs/",x), pattern = "\\.bam$",full.names = T)
z <- lapply(y, import_and_count_bam)
a <- as.data.frame(t(as.data.frame(z)))
rownames(a) <- species
#a <- (a/f)*1000000
colnames(a) <- sample_name;
return(a)
}
SMH5 <- full_import("spd3", sample_name = "SMH5", f = 8160732)
SMH4 <- full_import("spd5", sample_name = "SMH4", f = 4058520)
SMH6 <- full_import("spd6", sample_name = "SMH6", f = 3619844)
SMH7 <- full_import("spd7", sample_name = "SMH7", f = 2038988)
DSMH5 <- full_import("spd4", sample_name = "DirectSMH5", f = 1444924)
DSMH4 <- full_import("spd8", sample_name = "DirectSMH4", f = 3282782)
DSMH6 <- full_import("spd9", sample_name = "DirectSMH6", f = 2379244)
DSMH7 <- full_import("spd10", sample_name = "DirectSMH7", f = 2280627)
all_alignments <- cbind(DSMH4,DSMH5,DSMH6,DSMH7,SMH4,SMH5,SMH6,SMH7)
all_alignments <- all_alignments %>% rownames_to_column(var="Species")
View(all_alignments)
smh4 <- import_and_count_bam("./varroabam/smh4.bam")
smh4
dsmh4 <- import_and_count_bam("./varroabam/dsmh4.bam")
dsmh4
all_alignments$Method <- "CPM"
all_alignments <- cbind(DSMH4,DSMH5,DSMH6,DSMH7,SMH4,SMH5,SMH6,SMH7)
all_alignments_cpmdsm <- cbind(DSMH4,DSMH5,DSMH6,DSMH7)
all_alignments_cpmsm <-  cbind(SMH4,SMH5,SMH6,SMH7)
all_alignments_cpmdsm$Method <- "CPM_DSM"
all_alignments_cpmsm$Method <- "CPM_SM"
all_alignments_merged <- merge(all_alignments_cpmdsm,all_alignments_cpmsm, by="Species")
all_alignments_cpmdsm <- cbind(DSMH4,DSMH5,DSMH6,DSMH7) %>% rownames_to_column(var="Species")
View(all_alignments_cpmdsm)
all_alignments_cpmdsm <- cbind(DSMH4,DSMH5,DSMH6,DSMH7) %>% rownames_to_column(var="Species")
all_alignments_cpmdsm$Method <- "CPM_DSM"
all_alignments_cpmsm <-  cbind(SMH4,SMH5,SMH6,SMH7) %>% rownames_to_column(var="Species")
all_alignments_cpmsm$Method <- "CPM_SM"
all_alignments_merged <- merge(all_alignments_cpmdsm,all_alignments_cpmsm, by="Species")
View(all_alignments_merged)
all_alignments_merged <- merge(all_alignments_cpmdsm,all_alignments_cpmsm, by=c("Species","Method"))
all_alignments_merged <- merge(all_alignments_cpmdsm,all_alignments_cpmsm, by=c("Method"))
View(all_alignments_merged)
View(all_alignments_cpmdsm)
alignments_cpmdsm <- all_alignments_cpmdsm %>% reshape2::melt(., .id_vars="Species")
alignments_cpmsm <- all_alignments_cpmsm %>% reshape2::melt(., .id_vars="Species")
all_alignments_merged <- merge(alignments_cpmdsm,alignments_cpmsm, by=c("Method"))
View(all_alignments_merged)
all_alignments_merged <- merge(alignments_cpmdsm,alignments_cpmsm, by=c("Species"))
View(all_alignments_melt)
View(all_alignments_merged)
all_alignments_merged <- rbind(alignments_cpmdsm,alignments_cpmsm)
View(all_alignments_merged)
all_alignments_merged$value <- log2(all_alignments_merged$value)
species_level_dsm <- species_level[,c(1:4)]
View(species_level_dsm)
species_level <- read.csv("./Varroa 2/species_level.csv", header = T, encoding = "UTF-8")
colnames(species_level) <- samples
species_level <- log2(species_level)
species_level$Species <- species
species_level_dsm <- species_level[,c(1:4)]
View(species_level_dsm)
View(species_level)
species_level_dsm <- species_level[,c(9,1:4)]
species_level_dsm$Method <- "DESeq2_DSM"
species_level_sm <- species_level[,c(9,5:8)]
species_level_sm$Method <- "DESeq2_SM"
View(species_level_sm)
all_deseq_merged <- rbind(species_level_dsm,species_level_sm)
all_species_dsm <- reshape2::melt(species_level_dsm, .id_vars = "Species")
all_species_sm <- reshape2::melt(all_species_sm, .id_vars = "Species")
all_species_sm <- reshape2::melt(species_level_sm, .id_vars = "Species")
all_deseq_merged <- rbind(all_species_dsm,all_species_sm)
all_data_merged <- rbind(all_deseq_merged,all_alignments_merged)
View(all_data_merged)
ggscatter(all_data_merged, x = "DESeq2_SM", y = "CPM_SM", palette = "jco", add = "reg.line", shape = "variable") +
theme_classic() +
facet_grid(. ~ Species + Method,scales = "free") +
theme(plot.title = element_text(size=14),
axis.text=element_text(size=12,colour = "black"),
axis.title=element_text(size=12),
legend.title = element_blank(),
legend.text = element_text(size = 12))+
ggtitle("Metagenomic correlation with Natural Varroa fall" ) +
ylab("Varroa count/day (log)") +
xlab("Normalised reads count (log)") +
stat_cor()
all_alignments_cpmdsm <- cbind(DSMH4,DSMH5,DSMH6,DSMH7,SMH4,SMH5,SMH6,SMH7)
all_alignments <- log2(all_alignments)
all_alignments <- all_alignments %>% rownames_to_column(var="Species")
all_alignments_melt <- reshape2::melt(all_alignments, .id_vars = "Species")
samples <- c("DirectSMH4","DirectSMH5", "DirectSMH6","DirectSMH7","SMH4","SMH5","SMH6","SMH7")
species_level <- read.csv("./Varroa 2/species_level.csv", header = T, encoding = "UTF-8")
colnames(species_level) <- samples
species_level <- log2(species_level)
species_level$Species <- species
species_level_melt <- species_level %>% reshape2::melt(., .id_vars="Species")
combined_data <- merge(all_alignments_melt,species_level_melt, by=c("Species","variable"))
colnames(combined_data) <- c("Species","Sample","CPM","DESeq2")
combined_data$Method <- rep(c("DirectSM","DirectSM","DirectSM","DirectSM","SM","SM","SM","SM"), 6)
View(combined_data)
combined_data$Method <- rep(c("DirectSM","DirectSM","DirectSM","DirectSM","SM","SM","SM","SM"), 15)
combined_data$Method <- rep(c("DirectSM","DirectSM","DirectSM","DirectSM","SM","SM","SM","SM"), 10)
combined_data <- combined_data[combined_data$DESeq2 > 0,]
ggscatter(combined_data, x = "DESeq2", y = "CPM", palette = "jco", add = "reg.line", shape = "Sample") +
theme_classic() +
facet_grid(. ~ Species + Method,scales = "free") +
theme(plot.title = element_text(size=14),
axis.text=element_text(size=12,colour = "black"),
axis.title=element_text(size=12),
legend.title = element_blank(),
legend.text = element_text(size = 12))+
ggtitle("Metagenomic correlation with Natural Varroa fall" ) +
ylab("Varroa count/day (log)") +
xlab("Normalised reads count (log)") +
stat_cor()
species_level <- read.csv("./Varroa 2/genus_level.csv", header = T, encoding = "UTF-8")
colnames(species_level) <- samples
species_level <- log2(species_level)
species_level$Species <- species
species_level_melt <- species_level %>% reshape2::melt(., .id_vars="Species")
combined_data <- merge(all_alignments_melt,species_level_melt, by=c("Species","variable"))
colnames(combined_data) <- c("Species","Sample","CPM","DESeq2")
combined_data$Method <- rep(c("DirectSM","DirectSM","DirectSM","DirectSM","SM","SM","SM","SM"), 10)
combined_data <- combined_data[combined_data$DESeq2 > 0,]
ggscatter(combined_data, x = "DESeq2", y = "CPM", palette = "jco", add = "reg.line", shape = "Sample") +
theme_classic() +
facet_grid(. ~ Species + Method,scales = "free") +
theme(plot.title = element_text(size=14),
axis.text=element_text(size=12,colour = "black"),
axis.title=element_text(size=12),
legend.title = element_blank(),
legend.text = element_text(size = 12))+
ggtitle("Metagenomic correlation with Natural Varroa fall" ) +
ylab("Varroa count/day (log)") +
xlab("Normalised reads count (log)") +
stat_cor()
ggscatter(combined_data, x = "DESeq2", y = "CPM", palette = "jco", add = "reg.line", shape = "Sample") +
theme_classic() +
facet_grid(Species~Method,scales = "free") +
theme(plot.title = element_text(size=14),
axis.text=element_text(size=12,colour = "black"),
axis.title=element_text(size=12),
legend.title = element_blank(),
legend.text = element_text(size = 12))+
ggtitle("Metagenomic correlation with Natural Varroa fall" ) +
ylab("Varroa count/day (log)") +
xlab("Normalised reads count (log)") +
stat_cor()
ggscatter(combined_data, x = "DESeq2", y = "CPM", palette = "jco", add = "reg.line", shape = "Sample") +
theme_classic() +
facet_grid(Method~Species,scales = "free") +
theme(plot.title = element_text(size=14),
axis.text=element_text(size=12,colour = "black"),
axis.title=element_text(size=12),
legend.title = element_blank(),
legend.text = element_text(size = 12))+
ggtitle("Metagenomic correlation with Natural Varroa fall" ) +
ylab("Varroa count/day (log)") +
xlab("Normalised reads count (log)") +
stat_cor()
library(ggpubr)
library(ggsci)
ggscatter(combined_data, x = "DESeq2", y = "CPM", palette = "jco", add = "reg.line", shape = "Sample") +
theme_classic() +
facet_grid(Method~Species,scales = "free") +
theme(plot.title = element_text(size=14),
axis.text=element_text(size=12,colour = "black"),
axis.title=element_text(size=12),
legend.title = element_blank(),
legend.text = element_text(size = 12))+
ggtitle("Metagenomic correlation with Natural Varroa fall" ) +
ylab("Varroa count/day (log)") +
xlab("Normalised reads count (log)") +
stat_cor()
ggscatter(combined_data, x = "DESeq2", y = "CPM", palette = "jco", add = "reg.line", shape = "Sample") +
theme_classic() +
facet_grid(Method~Species,scales = "free") +
theme(plot.title = element_text(size=14),
axis.text=element_text(size=12,colour = "black"),
axis.title=element_text(size=12),
legend.title = element_blank(),
legend.text = element_text(size = 12))+  stat_cor()
ggscatter(combined_data, x = "DESeq2", y = "CPM", palette = "jco", add = "reg.line", shape = "Sample") +
theme_classic() +
facet_grid(Method~Species,scales = "free") +
theme(plot.title = element_text(size=14),
axis.text=element_text(size=12,colour = "black"),
axis.title=element_text(size=12),
legend.title = element_blank(),
legend.text = element_text(size = 12))+  stat_cor()
ggscatter(combined_data, x = "DESeq2", y = "CPM", palette = "jco", add = "reg.line", shape = "Sample", color = "Species") +
theme_classic() +
facet_grid(Method~Species,scales = "free") +
theme(plot.title = element_text(size=14),
axis.text=element_text(size=12,colour = "black"),
axis.title=element_text(size=12),
legend.title = element_blank(),
legend.text = element_text(size = 12))+  stat_cor()
DSMH4
full_import <- function(x, sample_name,f) {
y <- list.files(paste0("./varroa 2/wgs/",x), pattern = "\\.bam$",full.names = T)
z <- lapply(y, import_and_count_bam)
a <- as.data.frame(t(as.data.frame(z)))
rownames(a) <- species
a <- (a/f)*1000000
colnames(a) <- sample_name;
return(a)
}
SMH5 <- full_import("spd3", sample_name = "SMH5", f = 8160732)
SMH4 <- full_import("spd5", sample_name = "SMH4", f = 4058520)
SMH6 <- full_import("spd6", sample_name = "SMH6", f = 3619844)
SMH7 <- full_import("spd7", sample_name = "SMH7", f = 2038988)
DSMH5 <- full_import("spd4", sample_name = "DirectSMH5", f = 1444924)
DSMH4 <- full_import("spd8", sample_name = "DirectSMH4", f = 3282782)
DSMH6 <- full_import("spd9", sample_name = "DirectSMH6", f = 2379244)
DSMH7 <- full_import("spd10", sample_name = "DirectSMH7", f = 2280627)
all_alignments_cpmdsm <- cbind(DSMH4,DSMH5,DSMH6,DSMH7,SMH4,SMH5,SMH6,SMH7)
all_alignments <- log2(all_alignments)
all_alignments <- all_alignments %>% rownames_to_column(var="Species")
all_alignments <- cbind(DSMH4,DSMH5,DSMH6,DSMH7,SMH4,SMH5,SMH6,SMH7)
all_alignments <- log2(all_alignments)
all_alignments <- all_alignments %>% rownames_to_column(var="Species")
all_alignments_melt <- reshape2::melt(all_alignments, .id_vars = "Species")
samples <- c("DirectSMH4","DirectSMH5", "DirectSMH6","DirectSMH7","SMH4","SMH5","SMH6","SMH7")
species_level <- read.csv("./Varroa 2/genus_level.csv", header = T, encoding = "UTF-8")
colnames(species_level) <- samples
species_level <- log2(species_level)
species_level$Species <- species
species_level_melt <- species_level %>% reshape2::melt(., .id_vars="Species")
combined_data <- merge(all_alignments_melt,species_level_melt, by=c("Species","variable"))
colnames(combined_data) <- c("Species","Sample","CPM","DESeq2")
combined_data$Method <- rep(c("DirectSM","DirectSM","DirectSM","DirectSM","SM","SM","SM","SM"), 10)
combined_data <- combined_data[combined_data$DESeq2 > 0,]
ggscatter(combined_data, x = "DESeq2", y = "CPM",
add = "reg.line",                                 # Add regression line
conf.int = TRUE,                                  # Add confidence interval
add.params = list(color = "blue",
fill = "lightgray")
)+ stat_cor(method = "pearson", label.x = 3, label.y = 15) + ggtitle("Using kraken2 Species level")   # Add correlation coefficient
ggscatter(combined_data, x = "DESeq2", y = "CPM", palette = "jco", add = "reg.line", shape = "Sample", color = "Species") +
theme_classic() +
facet_grid(Method~Species,scales = "free") +
theme(plot.title = element_text(size=14),
axis.text=element_text(size=12,colour = "black"),
axis.title=element_text(size=12),
legend.title = element_blank(),
legend.text = element_text(size = 12))+  stat_cor()
species_level$DirectSMH4 <- species_level$DirectSMH4/3282781
species_level$DirectSMH5 <- species_level$DirectSMH5/1444924
species_level$DirectSMH6 <- species_level$DirectSMH6/2379244
species_level$DirectSMH7 <- species_level$DirectSMH7/2280627
species_level$SMH4 <- species_level$SMH4/4058520
species_level$SMH5 <- species_level$SMH5/8160732
species_level$SMH6 <- species_level$SMH6/3619844
species_level$SMH7 <- species_level$SMH7/2038988
species_level_melt <- species_level %>% reshape2::melt(., .id_vars="Species")
combined_data <- merge(all_alignments_melt,species_level_melt, by=c("Species","variable"))
colnames(combined_data) <- c("Species","Sample","CPM","DESeq2")
combined_data$Method <- rep(c("DirectSM","DirectSM","DirectSM","DirectSM","SM","SM","SM","SM"), 10)
combined_data <- combined_data[combined_data$DESeq2 > 0,]
ggscatter(combined_data, x = "DESeq2", y = "CPM",
add = "reg.line",                                 # Add regression line
conf.int = TRUE,                                  # Add confidence interval
add.params = list(color = "blue",
fill = "lightgray")
)+ stat_cor(method = "pearson", label.x = 3, label.y = 15) + ggtitle("Using kraken2 Species level")   # Add correlation coefficient
ggscatter(combined_data, x = "DESeq2", y = "CPM", palette = "jco", add = "reg.line", shape = "Sample", color = "Species") +
theme_classic() +
facet_grid(Method~Species,scales = "free") +
theme(plot.title = element_text(size=14),
axis.text=element_text(size=12,colour = "black"),
axis.title=element_text(size=12),
legend.title = element_blank(),
legend.text = element_text(size = 12))+  stat_cor()
